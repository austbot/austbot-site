---
title: "Overcoming &#x60;npm install&#x60; in Docker..."
date: "2017-08-15T16:46:00.000Z"
description: "At Ygrene, we build javascript code all day long. We do that with the help of Bitbucket, Bamboo CI server, and Docker. As many of you know, the f..."
image: 
link: https://ygrene.tech/overcoming-npm-install-in-docker-24cdac0326ad?source&#x3D;rss-993e52e8750e------2
---
<figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*kUUwWpwVaAuFLMiaOOhncg.jpeg" /></figure><p>At Ygrene, we build javascript code all day long. We do that with the help of Bitbucket, Bamboo CI server, and Docker. As many of you know, the first step in any modern javascript build is `npm install`. This fills your drive thousands of tiny javascript files, executables and whatever else. Each one of those files has a complete set of metadata and permissions assignments. When using Docker you will notice that all your commands run as root by default. This causes file permissions errors. Due to this fact, created files will now have a root or ‘0’ `uuid` the surrounding CI server thinks they belong to root. For subsequent npm scripts the errors were of the class:</p><pre>npm ERR! Error: EACCES: permission denied</pre><p>We needed to find a solution to this problem. In previous versions of Docker, our team had to create delegation scripts. These scripts took your command as a string, changed users and ran it. We needed our commands to execute as a user who could access any created files from the lifetime of the command. These workarounds required base images that held the scripts. This narrowed the images we could pull from Docker hub, and complicated the use when we did. Thanks to newer versions of Docker we can remove the scripts and use any Docker Hub image. By throwing the ` — user` argument to `docker run`, we are able to enforce that the command runs under the `uuid` we passed in. Your needs may vary, so Docker has provided flexibility in the run command. For more info check out the Docker run — user docs.</p><p>Since we use the newest version of bamboo, we can take advantage of Bamboo Specs. Here is a Java snippet for how we make Docker containers run on bamboo.</p><iframe src="" width="0" height="0" frameborder="0" scrolling="no"><a href="https://medium.com/media/90a7d3090992739463366ce52c6297f0/href">https://medium.com/media/90a7d3090992739463366ce52c6297f0/href</a></iframe><p>While you are down here: <em>All opinions are my own, and do not necessarily reflect those of my employer.</em></p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=24cdac0326ad" width="1" height="1"><hr><p><a href="https://ygrene.tech/overcoming-npm-install-in-docker-24cdac0326ad">Overcoming `npm install` in Docker</a> was originally published in <a href="https://ygrene.tech">Ygrene Tech</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>